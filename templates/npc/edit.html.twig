{% extends 'base.html.twig' %}

{% block title %}Update NPC{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="/css/dashboard.css">
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="/js/npc_skills_form.js" defer></script>
{% endblock %}

{% block body %}
  <header class="search-bar">
    <h1 class="title">Update NPC</h1>
  </header>

  <div class="layout">
    {% include 'components/dashboard_sidebar.html.twig' with { active: 'dashboard' } %}

    <main class="content">
      {% for message in app.flashes('success') %}
        <p class="status">{{ message }}</p>
      {% endfor %}

      <section class="cards">
        <article class="card form-card">
          <h3>NPC Profile</h3>

          {{ form_start(form, { method: 'PATCH', attr: { class: 'dashboard-form' } }) }}
            <div class="form-grid">
              <div class="form-group">
                {{ form_label(form.name) }}
                {{ form_widget(form.name, { attr: { class: 'form-control', placeholder: 'NPC name' } }) }}
                {{ form_errors(form.name) }}
              </div>

              <div class="form-group">
                {{ form_label(form.notes) }}
                {{ form_widget(form.notes, { attr: { class: 'form-control', rows: 5, placeholder: 'Optional notes' } }) }}
                {{ form_errors(form.notes) }}
              </div>

              <div class="form-group">
                {{ form_label(form.role) }}
                {{ form_widget(form.role, { attr: { class: 'form-control' } }) }}
                {{ form_errors(form.role) }}
              </div>

              <div class="form-group">
                {{ form_label(form.location) }}
                {{ form_widget(form.location, { attr: { class: 'form-control' } }) }}
                {{ form_errors(form.location) }}
              </div>

              <div class="form-group">
                <p>SPECIAL Stats:</p>
                <div class="special-grid">
                  <div>
                    {{ form_label(form.strength) }}
                    {{ form_widget(form.strength, { attr: { class: 'form-control', min: 4, max: 12 } }) }}
                    {{ form_errors(form.strength) }}
                  </div>

                  <div>
                    {{ form_label(form.perception) }}
                    {{ form_widget(form.perception, { attr: { class: 'form-control', min: 4, max: 12 } }) }}
                    {{ form_errors(form.perception) }}
                  </div>

                  <div>
                    {{ form_label(form.endurance) }}
                    {{ form_widget(form.endurance, { attr: { class: 'form-control', min: 4, max: 12 } }) }}
                    {{ form_errors(form.endurance) }}
                  </div>

                  <div>
                    {{ form_label(form.charisma) }}
                    {{ form_widget(form.charisma, { attr: { class: 'form-control', min: 4, max: 12 } }) }}
                    {{ form_errors(form.charisma) }}
                  </div>

                  <div>
                    {{ form_label(form.intelligence) }}
                    {{ form_widget(form.intelligence, { attr: { class: 'form-control', min: 4, max: 12 } }) }}
                    {{ form_errors(form.intelligence) }}
                  </div>

                  <div>
                    {{ form_label(form.agility) }}
                    {{ form_widget(form.agility, { attr: { class: 'form-control', min: 4, max: 12 } }) }}
                    {{ form_errors(form.agility) }}
                  </div>

                  <div>
                    {{ form_label(form.luck) }}
                    {{ form_widget(form.luck, { attr: { class: 'form-control', min: 4, max: 12 } }) }}
                    {{ form_errors(form.luck) }}
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="skills-head">
                  <p>Skills:</p>
                  <button type="button" class="side-btn add-skill-btn" data-action="add-skill">Add Skill</button>
                </div>
                {% set prototype %}
                  {% set skillForm = form.npcSkills.vars.prototype %}
                  {% include 'npc/_skill_row.html.twig' %}
                {% endset %}
                <div
                  class="npc-skills-collection"
                  data-collection-holder
                  data-add-action="add-skill"
                  data-index="{{ form.npcSkills|length }}"
                  data-prototype="{{ prototype|e('html_attr') }}"
                >
                  {% for skillForm in form.npcSkills %}
                    {% include 'npc/_skill_row.html.twig' %}
                  {% endfor %}
                </div>
                {{ form_errors(form.npcSkills) }}
              </div>

              <div class="form-group">
                <div class="skills-head">
                  <p>Knowledge:</p>
                  <button type="button" class="side-btn add-skill-btn" data-action="add-knowledge">Add Knowledge</button>
                </div>
                {% set prototype %}
                  {% set knowledgeForm = form.knowledge.vars.prototype %}
                  {% include 'npc/_knowledge_row.html.twig' %}
                {% endset %}
                <div
                  class="npc-knowledge-collection"
                  data-collection-holder
                  data-add-action="add-knowledge"
                  data-index="{{ form.knowledge|length }}"
                  data-prototype="{{ prototype|e('html_attr') }}"
                >
                  {% for knowledgeForm in form.knowledge %}
                    {% include 'npc/_knowledge_row.html.twig' %}
                  {% endfor %}
                </div>
                {{ form_errors(form.knowledge) }}
              </div>
              {% do form.npcSkills.setRendered() %}
              {% do form.knowledge.setRendered() %}
            </div>

            <div class="form-actions">
              <a href="/npcs/{{ npc.id }}" class="side-btn">Cancel</a>
              <button type="submit" class="cta">Save NPC</button>
            </div>
          {{ form_end(form) }}
        </article>
      </section>
    </main>
  </div>
{% endblock %}
